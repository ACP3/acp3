add-gitlab-release:
  stage: release
  image: registry.gitlab.com/gitlab-org/release-cli:latest
  rules:
    - if: $CI_COMMIT_TAG
  variables:
    ASSET_URL: "https://gitlab.com/ACP3/cms/-/jobs/artifacts/$CI_COMMIT_TAG/download?job=release-artifact"
  script:
    - CHANGELOG_MAJOR_VERSION=${CI_COMMIT_TAG:1}|cut -d"." -f 1
    - |
      release-cli create \
        --name "Release $CI_COMMIT_TAG" \
        --tag-name $CI_COMMIT_TAG \
        --description "[Changelog](https://gitlab.com/ACP3/cms/-/blob/$CI_COMMIT_TAG/CHANGELOG-${CHANGELOG_MAJOR_VERSION}.x.md) " \
        --assets-link "{\"name\":\"ACP3 CMS $CI_COMMIT_TAG\",\"url\":\"${ASSET_URL}\"}"
