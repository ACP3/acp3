services:
  core.assets.event_listener.static_assets_listener:
    class: ACP3\Core\Assets\EventListener\StaticAssetsListener
    arguments:
      - '@core.assets.renderer.css_renderer'
      - '@core.assets.renderer.javascript_renderer'
      - '@request_stack'
      - '@core.assets.libraries'
      - '@core.assets.libraries_cache'
    tags:
      - { name: core.eventSubscriber }

  core.assets:
    class: ACP3\Core\Assets
    arguments:
      - '@core.environment.theme'
      - '@core.assets.libraries'

  core.assets.cache:
    class: ACP3\Core\Assets\Cache
    arguments:
      - '@core.cache.system'

  core.assets.logger:
    class: Psr\Log\LoggerInterface
    factory: ['@core.logger.logger_factory', 'create']
    arguments:
      - 'assets'

  core.assets.abstract_minifier:
    class: ACP3\Core\Assets\Renderer\Strategies\AbstractConcatRendererStrategy
    arguments:
      - '@core.assets.logger'
      - '@core.assets'
      - '@core.assets.libraries'
      - '@core.environment.application_path'
      - '@core.cache.system'
      - '@core.config'
      - '@core.modules'
      - '@core.assets.file_resolver'
    abstract: true

  core.assets.renderer.strategy.css:
    class: ACP3\Core\Assets\Renderer\Strategies\CSSRendererStrategy
    arguments:
      - '@core.assets'
      - '@core.assets.libraries'
      - '@core.modules'
      - '@core.assets.file_resolver'

  core.assets.renderer.strategy.deferrable_css:
    class: ACP3\Core\Assets\Renderer\Strategies\DeferrableCSSRendererStrategy
    arguments:
      - '@core.assets'
      - '@core.assets.libraries'
      - '@core.assets.file_resolver'

  core.assets.renderer.strategy.javascript:
    class: ACP3\Core\Assets\Renderer\Strategies\JavaScriptRendererStrategy
    arguments:
      - '@core.assets'
      - '@core.assets.file_resolver'
      - '@core.assets.libraries'

  core.assets.renderer.strategy.concat_css:
    class: ACP3\Core\Assets\Renderer\Strategies\ConcatCSSRendererStrategy
    parent: core.assets.abstract_minifier

  core.assets.renderer.strategy.concat_deferrable_css:
    class: ACP3\Core\Assets\Renderer\Strategies\ConcatDeferrableCSSRendererStrategy
    parent: core.assets.abstract_minifier

  core.assets.renderer.strategy.concat_javascript:
    class: ACP3\Core\Assets\Renderer\Strategies\ConcatJavaScriptRendererStrategy
    parent: core.assets.abstract_minifier

  core.assets.file_resolver:
    class: ACP3\Core\Assets\FileResolver
    arguments:
      - '@core.assets.cache'
      - '@core.environment.application_path'
      - '@core.environment.theme'

  core.assets.include_js:
    class: ACP3\Core\Assets\IncludeJs
    arguments:
      - '@core.assets.libraries'
      - '@core.assets.file_resolver'
      - '@core.environment.application_path'

  core.assets.include_stylesheet:
    class: ACP3\Core\Assets\IncludeStylesheet
    arguments:
      - '@core.assets.libraries'
      - '@core.assets.file_resolver'
      - '@core.environment.application_path'

  core.assets.libraries:
    class: ACP3\Core\Assets\Libraries
    arguments:
      - '@request_stack'
      - '@core.event_dispatcher'
      - '@core.assets.libraries_cache'

  core.assets.cache_namespace_libraries:
    class: ACP3\Core\Cache
    arguments:
      - '@core.cache.cache_driver_factory'
      - 'libraries'

  core.assets.libraries_cache:
    class: ACP3\Core\Assets\LibrariesCache
    arguments:
      - '@core.assets.cache_namespace_libraries'

  core.assets.page_css_classes:
    class: ACP3\Core\Assets\PageCssClasses
    arguments:
      - '@core.helpers.string_formatter'
      - '@core.breadcrumb.title'
      - '@core.http.request'

  core.assets.renderer.strategy.service_locator:
    class: Symfony\Component\DependencyInjection\ServiceLocator
    arguments:
      - css_renderer_dev: '@core.assets.renderer.strategy.css'
        css_renderer_prod: '@core.assets.renderer.strategy.concat_css'
        deferrable_css_renderer_dev: '@core.assets.renderer.strategy.deferrable_css'
        deferrable_css_renderer_prod: '@core.assets.renderer.strategy.concat_deferrable_css'
        javascript_renderer_dev: '@core.assets.renderer.strategy.javascript'
        javascript_renderer_prod: '@core.assets.renderer.strategy.concat_javascript'
    tags: ['container.service_locator']

  core.assets.renderer.css_renderer:
    class: ACP3\Core\Assets\Renderer\CSSRenderer
    factory: ['@core.assets.renderer.css_renderer_factory', 'create']

  core.assets.renderer.css_renderer_factory:
    class: ACP3\Core\Assets\Renderer\CSSRendererFactory
    arguments:
      - '@core.assets.renderer.strategy.service_locator'
      - '%core.environment%'

  core.assets.renderer.javascript_renderer:
    class: ACP3\Core\Assets\Renderer\JavaScriptRenderer
    factory: ['@core.assets.renderer.javascript_renderer_factory', 'create']

  core.assets.renderer.javascript_renderer_factory:
    class: ACP3\Core\Assets\Renderer\JavaScriptRendererFactory
    arguments:
      - '@core.assets.renderer.strategy.service_locator'
      - '%core.environment%'
