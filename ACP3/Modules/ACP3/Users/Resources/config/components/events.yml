services:
  _defaults:
    autowire: true

  users.event.forbid_super_user_delete_listener:
    class: ACP3\Modules\ACP3\Users\Event\Listener\ForbidSuperUserDeleteListener
    tags:
      - { name: core.eventListener, event: users.model.users.before_delete }

  users.event.is_user_authenticated_listener:
    class: ACP3\Modules\ACP3\Users\Event\Listener\IsUserAuthenticatedListener
    tags:
      - {
          name: core.eventListener,
          event: core.application.controller_action_dispatcher.before_dispatch,
          priority: 255,
        }

  users.event.send_registration_mail_listener:
    class: ACP3\Modules\ACP3\Users\Event\Listener\SendRegistrationMailListener
    tags:
      - { name: core.eventListener, event: users.model.users.after_save }

  users.events.hash_password_on_user_model_prepare_data:
    class: ACP3\Modules\ACP3\Users\Event\Listener\HashPasswordOnUserModelPrepareData
    tags:
      - { name: core.eventListener, event: users.model.users.prepare_data }

  users.events.user_context_listener:
    class: ACP3\Modules\ACP3\Users\Event\Listener\UserContextListener
    arguments:
      - user_hash_uri: "/widget/users/index/hash/"
        session_name_prefix: !php/const ACP3\Core\Session\SessionConstants::SESSION_NAME
    tags:
      - { name: core.eventSubscriber }
