"use strict";function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c.return||c.return()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}/*
 * Copyright (c) by the ACP3 Developers.
 * See the LICENSE file at the top-level module directory for licencing details.
 */(function(a,b,c){'use strict';var d=/*#__PURE__*/function(){function d(b,c){_classCallCheck(this,d),this.element=b,this.isFormValid=!0,this._defaults={targetElement:"#content",loadingOverlay:!0,loadingText:"",customFormData:null,scrollOffsetElement:null,method:null},this.settings=a.extend({},this._defaults,c),this._name="formSubmit",this.init()}return _createClass(d,[{key:"init",value:function init(){var b=this,d=this;this.mergeSettings(),this.findSubmitButton(),this.addLoadingLayer(),this.element.noValidate=!0,a(this.element).on("submit",function(d){d.preventDefault(),b.isFormValid=!0,a(c).trigger("acp3.ajaxFrom.submit.before",[b]),b.isFormValid&&b.preValidateForm(b.element)&&b.processAjaxRequest()}).on("click",function(b){"A"===a(this).prop("tagName")&&(b.preventDefault(),d.processAjaxRequest())}).on("change",function(){!1===b.isFormValid&&(b.removeAllPreviousErrors(),b.checkFormElementsForErrors(b.element))})}},{key:"mergeSettings",value:function mergeSettings(){var b=a(this.element).data();for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=this.lowerCaseFirstLetter(c.replace("ajaxForm",""));0<d.length&&"undefined"!=typeof this.settings[d]&&(this.settings[d]=b[c])}}},{key:"lowerCaseFirstLetter",value:function lowerCaseFirstLetter(a){return a.charAt(0).toLowerCase()+a.slice(1)}},{key:"findSubmitButton",value:function findSubmitButton(){a(this.element).find(":submit").click(function(){a(":submit",a(this).closest("form")).removeAttr("data-clicked"),a(this).attr("data-clicked","true")})}},{key:"preValidateForm",value:function preValidateForm(a){return this.removeAllPreviousErrors(),this.checkFormElementsForErrors(a),this.focusTabWithFirstErrorMessage(),this.scrollToFirstFormError(),this.isFormValid}},{key:"removeAllPreviousErrors",value:function removeAllPreviousErrors(){a("form .form-group.has-error").removeClass("has-error").find(".validation-failed").remove()}},{key:"checkFormElementsForErrors",value:function checkFormElementsForErrors(b){var c,d=_createForOfIteratorHelper(b.elements);try{for(d.s();!(c=d.n()).done;){var e=c.value;("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName||"SELECT"===e.nodeName)&&(e.checkValidity()||(this.addErrorDecorationToFormGroup(a(e)),this.addErrorMessageToFormField(a(e),e.validationMessage),this.isFormValid=!1))}}catch(a){d.e(a)}finally{d.f()}}},{key:"addErrorDecorationToFormGroup",value:function addErrorDecorationToFormGroup(a){a.closest(".form-group").addClass("has-error")}},{key:"removeErrorMessageFromFormField",value:function removeErrorMessageFromFormField(a){a.closest("div").find(".validation-failed").remove()}},{key:"addErrorMessageToFormField",value:function addErrorMessageToFormField(a,b){this.removeErrorMessageFromFormField(a),a.closest("div:not(.input-group):not(.btn-group)").append("<small class=\"help-block validation-failed\"><i class=\"fas fa-exclamation-circle\"></i> "+b+"</small>")}},{key:"focusTabWithFirstErrorMessage",value:function focusTabWithFirstErrorMessage(){if(0<a(".tabbable").length){var b=a(".tabbable .form-group.has-error:first"),c=b.closest(".tab-pane").prop("id");a(".tabbable .nav-tabs a[href=\"#"+c+"\"]").tab("show"),b.find(":input").focus()}}},{key:"processAjaxRequest",value:function processAjaxRequest(){var d,e,f,g,h=this,i=a(this.element),j=!a.isEmptyObject(this.settings.customFormData),k=!0,l=this.settings.customFormData||{};if(i.attr("method")){if(g=a(":submit[data-clicked=\"true\"]",i),f=g.data("hashChange"),l=new FormData(i[0]),g.length&&l.append(g.attr("name"),1),j)for(var m in this.settings.customFormData)Object.prototype.hasOwnProperty.call(this.settings.customFormData,m)&&l.append(m,this.settings.customFormData[m]);k=!1}else f=i.data("hashChange");a.ajax({url:i.attr("action")||i.attr("href"),type:i.attr("method")?i.attr("method").toUpperCase():null!==(d=null===(e=this.settings.method)||void 0===e?void 0:e.toUpperCase())&&void 0!==d?d:"GET",data:l,processData:k,contentType:!!k&&"application/x-www-form-urlencoded; charset=UTF-8",beforeSend:function beforeSend(){h.showLoadingLayer(g),h.disableSubmitButton(g)}}).done(function(d){try{var e=i.data("ajax-form-complete-callback");"function"==typeof b[e]?b[e](d):d.redirect_url?h.redirectToNewPage(f,d):(h.scrollIntoView(),h.replaceContent(f,d),h.rebindHandlers(f),a(c).trigger("acp3.ajaxFrom.complete"),"undefined"!=typeof f&&(b.location.hash=f))}catch(a){console.error(a)}}).fail(function(b){400===b.status?(h.handleFormErrorMessages(i,b.responseText),h.scrollToFirstFormError(),a(c).trigger("acp3.ajaxFrom.submit.fail",[h])):0<b.responseText.length&&(c.open(),c.write(b.responseText),c.close())}).always(function(){h.hideLoadingLayer(),h.enableSubmitButton(g)})}},{key:"addLoadingLayer",value:function addLoadingLayer(){if(!1!==this.settings.loadingOverlay){var b=a("#loading-layer");if(0===b.length){var c=a("body"),d=this.settings.loadingText||"";a("<div id=\"loading-layer\" class=\"loading-layer\"><h1><span class=\"fas fa-spinner fa-spin\"></span> "+d+"</h1></div>").appendTo(c)}}}},{key:"showLoadingLayer",value:function showLoadingLayer(){a("#loading-layer").addClass("loading-layer__active")}},{key:"disableSubmitButton",value:function disableSubmitButton(a){"undefined"!=typeof a&&a.prop("disabled",!0)}},{key:"enableSubmitButton",value:function enableSubmitButton(a){"undefined"!=typeof a&&a.prop("disabled",!1)}},{key:"redirectToNewPage",value:function redirectToNewPage(a,c){"undefined"==typeof a?b.location.href=c.redirect_url:(b.location.href=c.redirect_url+a,b.location.reload())}/**
         * Scroll to the beginning of the content area, if the current viewport is near the bottom
         */},{key:"scrollIntoView",value:function scrollIntoView(){var b=a(this.settings.targetElement).offset().top;a(c).scrollTop()>b&&a("html, body").animate({scrollTop:b},"fast")}},{key:"replaceContent",value:function replaceContent(b,c){b&&a(b).length?a(b).html(a(c).find(b).html()):a(this.settings.targetElement).html(c)}},{key:"rebindHandlers",value:function rebindHandlers(b){var c=b&&a(b).length?a(b):a(this.settings.targetElement);c.find("[data-ajax-form=\"true\"]").formSubmit(),this.findSubmitButton()}},{key:"hideLoadingLayer",value:function hideLoadingLayer(){a("#loading-layer").removeClass("loading-layer__active")}},{key:"handleFormErrorMessages",value:function handleFormErrorMessages(b,c){var d=a("#error-box"),e=b.find(".modal-body");d.remove(),d=a(c),d.hide().prependTo(0<e.length&&e.is(":visible")?e:b).fadeIn(),this.prettyPrintResponseErrorMessages(b,d)}},{key:"prettyPrintResponseErrorMessages",value:function prettyPrintResponseErrorMessages(b,c){var d=this;this.removeAllPreviousErrors(),c.find("li").each(function(c,e){var f=a(e),g=f.data("error");if(0<g.length){var h=b.find("#"+g)||b.find("[id|=\""+g+"\"]").filter(":not([id$=\"container\"])");0<h.length&&(d.addErrorDecorationToFormGroup(h),1===h.length&&(d.addErrorMessageToFormField(h,f.html()),f.remove()))}}),0===c.find("li").length&&c.remove(),this.focusTabWithFirstErrorMessage()}},{key:"scrollToFirstFormError",value:function scrollToFirstFormError(){var b=a(this.element),c=b.find(".form-group.has-error");if(!(0<b.closest(".modal").length)&&c&&0!==c.length&&!this.isElementInViewport(b.find(".help-block.validation-failed"))){var d=c.offset().top;if(this.settings.scrollOffsetElement){var e=a(this.settings.scrollOffsetElement);e&&0<e.length&&(d-=e.height())}a("html, body").animate({scrollTop:d},"fast")}}},{key:"isElementInViewport",value:function isElementInViewport(d){"function"==typeof jQuery&&d instanceof jQuery&&(d=d[0]);var e=a(this.settings.scrollOffsetElement),f=0;e&&(f=e.height());var g=d.getBoundingClientRect();return g.top>=f&&0<=g.left&&g.bottom<=(b.innerHeight||c.documentElement.clientHeight)&&g.right<=(b.innerWidth||c.documentElement.clientWidth)}}]),d}();a.fn.formSubmit=function(b){return this.each(function(){a.data(this,"plugin_formSubmit")||a.data(this,"plugin_formSubmit",new d(this,b))})}})(jQuery,window,document),function(a){a("[data-ajax-form=\"true\"]").formSubmit(),a(document).on("draw.dt",function(b){a(b.target).find("[data-ajax-form=\"true\"]").formSubmit()})}(jQuery);
//# sourceMappingURL=ajax-form.min.js.map