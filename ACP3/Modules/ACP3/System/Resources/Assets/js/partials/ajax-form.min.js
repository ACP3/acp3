!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function t(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var r;!function(r,o,n){var i=function(){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.element=e,this.isFormValid=!0,this._defaults={targetElement:"#content",loadingOverlay:!0,loadingText:"",customFormData:null,scrollOffsetElement:null,method:null},this.settings=r.extend({},this._defaults,t),this._name="formSubmit",this.init()}var a,s;return a=i,(s=[{key:"init",value:function(){var e=this,t=this;this.mergeSettings(),this.findSubmitButton(),this.addLoadingLayer(),this.element.noValidate=!0,r(this.element).on("submit",(function(t){t.preventDefault(),e.isFormValid=!0,r(n).trigger("acp3.ajaxFrom.submit.before",[e]),e.isFormValid&&e.preValidateForm(e.element)&&e.processAjaxRequest()})).on("click",(function(e){"A"===r(this).prop("tagName")&&(e.preventDefault(),t.processAjaxRequest())})).on("change",(function(){!1===e.isFormValid&&(e.removeAllPreviousErrors(),e.checkFormElementsForErrors(e.element))}))}},{key:"mergeSettings",value:function(){var e=r(this.element).data();for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var o=this.lowerCaseFirstLetter(t.replace("ajaxForm",""));o.length>0&&void 0!==this.settings[o]&&(this.settings[o]=e[t])}}},{key:"lowerCaseFirstLetter",value:function(e){return e.charAt(0).toLowerCase()+e.slice(1)}},{key:"findSubmitButton",value:function(){r(this.element).find(":submit").click((function(){r(":submit",r(this).closest("form")).removeAttr("data-clicked"),r(this).attr("data-clicked","true")}))}},{key:"preValidateForm",value:function(e){return this.removeAllPreviousErrors(),this.checkFormElementsForErrors(e),this.focusTabWithFirstErrorMessage(),this.scrollToFirstFormError(),this.isFormValid}},{key:"removeAllPreviousErrors",value:function(){r("form .form-group.has-error").removeClass("has-error").find(".validation-failed").remove()}},{key:"checkFormElementsForErrors",value:function(t){var o,n=function(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function(t,r){if(t){if("string"==typeof t)return e(t,void 0);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,void 0):void 0}}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,l=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var e=o.next();return s=e.done,e},e:function(e){l=!0,a=e},f:function(){try{s||null==o.return||o.return()}finally{if(l)throw a}}}}(t.elements);try{for(n.s();!(o=n.n()).done;){var i=o.value;"INPUT"!==i.nodeName&&"TEXTAREA"!==i.nodeName&&"SELECT"!==i.nodeName||i.checkValidity()||(this.addErrorDecorationToFormGroup(r(i)),this.addErrorMessageToFormField(r(i),i.validationMessage),this.isFormValid=!1)}}catch(a){n.e(a)}finally{n.f()}}},{key:"addErrorDecorationToFormGroup",value:function(e){e.closest(".form-group").addClass("has-error")}},{key:"removeErrorMessageFromFormField",value:function(e){e.closest("div").find(".validation-failed").remove()}},{key:"addErrorMessageToFormField",value:function(e,t){this.removeErrorMessageFromFormField(e),e.closest("div:not(.input-group):not(.btn-group)").append('<small class="help-block validation-failed"><i class="fas fa-exclamation-circle"></i> '+t+"</small>")}},{key:"focusTabWithFirstErrorMessage",value:function(){if(r(".tabbable").length>0){var e=r(".tabbable .form-group.has-error:first"),t=e.closest(".tab-pane").prop("id");r('.tabbable .nav-tabs a[href="#'+t+'"]').tab("show"),e.find(":input").focus()}}},{key:"processAjaxRequest",value:function(){var e,t,i,a,s=this,l=r(this.element),u=!r.isEmptyObject(this.settings.customFormData),c=!0,d=this.settings.customFormData||{};if(l.attr("method")){if(a=r(':submit[data-clicked="true"]',l),i=a.data("hashChange"),d=new FormData(l[0]),a.length&&d.append(a.attr("name"),1),u)for(var f in this.settings.customFormData)Object.prototype.hasOwnProperty.call(this.settings.customFormData,f)&&d.append(f,this.settings.customFormData[f]);c=!1}else i=l.data("hashChange");r.ajax({url:l.attr("action")||l.attr("href"),type:l.attr("method")?l.attr("method").toUpperCase():null!==(e=null===(t=this.settings.method)||void 0===t?void 0:t.toUpperCase())&&void 0!==e?e:"GET",data:d,processData:c,contentType:!!c&&"application/x-www-form-urlencoded; charset=UTF-8",beforeSend:function(){s.showLoadingLayer(a),s.disableSubmitButton(a)}}).done((function(e){try{var t=l.data("ajax-form-complete-callback");"function"==typeof o[t]?o[t](e):e.redirect_url?s.redirectToNewPage(i,e):(s.scrollIntoView(),s.replaceContent(i,e),s.rebindHandlers(i),r(n).trigger("acp3.ajaxFrom.complete"),void 0!==i&&(o.location.hash=i))}catch(a){console.error(a)}})).fail((function(e){400===e.status?(s.handleFormErrorMessages(l,e.responseText),s.scrollToFirstFormError(),r(n).trigger("acp3.ajaxFrom.submit.fail",[s])):e.responseText.length>0&&(n.open(),n.write(e.responseText),n.close())})).always((function(){s.hideLoadingLayer(),s.enableSubmitButton(a)}))}},{key:"addLoadingLayer",value:function(){if(!1!==this.settings.loadingOverlay&&0===r("#loading-layer").length){var e=r("body"),t=this.settings.loadingText||"";r('<div id="loading-layer" class="loading-layer"><h1><span class="fas fa-spinner fa-spin"></span> '+t+"</h1></div>").appendTo(e)}}},{key:"showLoadingLayer",value:function(){r("#loading-layer").addClass("loading-layer__active")}},{key:"disableSubmitButton",value:function(e){void 0!==e&&e.prop("disabled",!0)}},{key:"enableSubmitButton",value:function(e){void 0!==e&&e.prop("disabled",!1)}},{key:"redirectToNewPage",value:function(e,t){void 0!==e?(o.location.href=t.redirect_url+e,o.location.reload()):o.location.href=t.redirect_url}},{key:"scrollIntoView",value:function(){var e=r(this.settings.targetElement).offset().top;r(n).scrollTop()>e&&r("html, body").animate({scrollTop:e},"fast")}},{key:"replaceContent",value:function(e,t){e&&r(e).length?r(e).html(r(t).find(e).html()):r(this.settings.targetElement).html(t)}},{key:"rebindHandlers",value:function(e){(e&&r(e).length?r(e):r(this.settings.targetElement)).find('[data-ajax-form="true"]').formSubmit(),this.findSubmitButton()}},{key:"hideLoadingLayer",value:function(){r("#loading-layer").removeClass("loading-layer__active")}},{key:"handleFormErrorMessages",value:function(e,t){var o=r("#error-box"),n=e.find(".modal-body");o.remove(),(o=r(t)).hide().prependTo(n.length>0&&n.is(":visible")?n:e).fadeIn(),this.prettyPrintResponseErrorMessages(e,o)}},{key:"prettyPrintResponseErrorMessages",value:function(e,t){var o=this;this.removeAllPreviousErrors(),t.find("li").each((function(t,n){var i=r(n),a=i.data("error");if(a.length>0){var s=e.find("#"+a)||e.find('[id|="'+a+'"]').filter(':not([id$="container"])');s.length>0&&(o.addErrorDecorationToFormGroup(s),1===s.length&&(o.addErrorMessageToFormField(s,i.html()),i.remove()))}})),0===t.find("li").length&&t.remove(),this.focusTabWithFirstErrorMessage()}},{key:"scrollToFirstFormError",value:function(){var e=r(this.element),t=e.find(".form-group.has-error");if(!(e.closest(".modal").length>0)&&t&&0!==t.length&&!this.isElementInViewport(e.find(".help-block.validation-failed"))){var o=t.offset().top;if(this.settings.scrollOffsetElement){var n=r(this.settings.scrollOffsetElement);n&&n.length>0&&(o-=n.height())}r("html, body").animate({scrollTop:o},"fast")}}},{key:"isElementInViewport",value:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=r(this.settings.scrollOffsetElement),i=0;t&&(i=t.height());var a=e.getBoundingClientRect();return a.top>=i&&a.left>=0&&a.bottom<=(o.innerHeight||n.documentElement.clientHeight)&&a.right<=(o.innerWidth||n.documentElement.clientWidth)}}])&&t(a.prototype,s),i}();r.fn.formSubmit=function(e){return this.each((function(){r.data(this,"plugin_formSubmit")||r.data(this,"plugin_formSubmit",new i(this,e))}))}}(jQuery,window,document),(r=jQuery)('[data-ajax-form="true"]').formSubmit(),r(document).on("draw.dt",(function(e){r(e.target).find('[data-ajax-form="true"]').formSubmit()}))}();
//# sourceMappingURL=ajax-form.min.js.map
