(()=>{"use strict";function t(t,e,n){const i={...t,...e};if(!n)return i;for(let[t,e]of Object.entries(n)){const n=(o=t.replace("ajaxForm","")).charAt(0).toLowerCase()+o.slice(1);if(n.length>0&&void 0!==i[n])try{i[n]=JSON.parse(e)}catch{i[n]=e}}var o;return i}function e(t,e,n,i){t.addEventListener(e,(t=>{if("string"==typeof n){const e=document.querySelectorAll(n);if(!e)return;e.forEach((e=>{e&&e.contains(t.target)&&i(t,e)}))}else n&&n.contains(t.target)&&i(t,n)}))}function n(t,e){o(t,e),e.add(t)}function i(t,e,n){o(t,e),e.set(t,n)}function o(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,c(t,e,"get"))}function r(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function s(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,c(t,e,"set"),n),n}function c(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var l=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakSet,f=new WeakSet,m=new WeakSet,w=new WeakSet,p=new WeakSet,g=new WeakSet,v=new WeakSet,y=new WeakSet,E=new WeakSet,b=new WeakSet,S=new WeakSet;class k{constructor(t,e){n(this,S),n(this,b),n(this,E),n(this,y),n(this,v),n(this,g),n(this,p),n(this,w),n(this,m),n(this,f),n(this,h),i(this,l,{writable:!0,value:void 0}),i(this,d,{writable:!0,value:void 0}),i(this,u,{writable:!0,value:{completeCallback:null,targetElement:"#content",loadingOverlay:!0,customFormData:null,method:null}}),s(this,l,t),s(this,d,e),r(this,h,T).call(this)}async performAjaxRequest(e){const n=t(a(this,u),{},e.dataset);let i,o;e instanceof HTMLFormElement?(o=e.querySelector('[type="submit"][data-clicked="true"]'),i=o?.dataset.hashChange):i=e.dataset.hashChange,n.loadingOverlay&&(a(this,l).addLoadingIndicator(o||e),a(this,l).showLoadingIndicator(o||e)),r(this,g,F).call(this,o);try{const t=e.getAttribute("method")?.toUpperCase()??n.method?.toUpperCase()??"GET",s=await fetch(e.getAttribute("action")||e.getAttribute("href"),{method:t,body:"GET"!==t?r(this,m,W).call(this,e,o,n):null,headers:{"X-Requested-With":"XMLHttpRequest"}});s.ok?await r(this,p,L).call(this,s,i,n):await r(this,w,A).call(this,s,e)}catch(t){console.error(t)}finally{a(this,l).hideLoadingIndicator(o||e),r(this,v,j).call(this,o)}}}function T(){r(this,f,q).call(this),e(document,"click",'a[data-ajax-form="true"]',(async(t,e)=>{t.preventDefault(),await this.performAjaxRequest(e)})),e(document,"submit",'form[data-ajax-form="true"]',(async(t,e)=>{t.preventDefault(),a(this,d).setFormAsValid(e),document.dispatchEvent(new CustomEvent("acp3.ajaxFrom.submit.before",{detail:this})),a(this,d).isValid(e)&&a(this,d).preValidateForm(e)&&await this.performAjaxRequest(e)})),e(document,"change",'form[data-ajax-form="true"]',(async(t,e)=>{!1===a(this,d).isValid(e)&&a(this,d).checkFormElementsForErrors(e)}))}function q(){e(document,"click",'form[data-ajax-form="true"] [type="submit"]',((t,e)=>{e.closest("form").querySelectorAll("[type=submit]").forEach((t=>{delete t.dataset.clicked})),e.dataset.clicked="true"}))}function W(t,e,n){const i=n.customFormData||{};let o;t.getAttribute("method")?(o=new FormData(t),e&&o.append(e.getAttribute("name"),"1")):o=new FormData;for(let[t,e]of Object.entries(i))o.append(t,e);return o}async function A(t,e){const n=await t.clone().text();400===t.status?(a(this,d).handleFormErrorMessages(e,n),document.dispatchEvent(new CustomEvent("acp3.ajaxFrom.submit.fail",{detail:this}))):n.length>0&&(document.open(),document.write(n),document.close())}async function L(t,e,n){const i=await r(this,y,M).call(this,t);"function"==typeof window[n.completeCallback]?window[n.completeCallback](i):i.redirect_url?r(this,E,C).call(this,e,i):(r(this,S,x).call(this,e,i,n),r(this,b,V).call(this,e,n),void 0!==e&&(window.location.hash=e),document.dispatchEvent(new CustomEvent("acp3.ajaxFrom.complete")))}function F(t){t&&(t.disabled=!0)}function j(t){t&&(t.disabled=!1)}async function M(t){try{return await t.clone().json()}catch(e){return await t.clone().text()}}function C(t,e){void 0!==t?(window.location.href=e.redirect_url+t,window.location.reload()):window.location.href=e.redirect_url}function V(t,e){setTimeout((()=>{if(t){const e=document.querySelector(`[data-hash-change="${t}"]`);window.scrollTo({top:e.getBoundingClientRect().y,behavior:"smooth"})}else{const t=document.querySelector(e.targetElement).getBoundingClientRect().y;document.scrollTop>t&&window.scrollTo({top:t,behavior:"smooth"})}}))}function x(t,e,n){let i,o;if(t&&document.querySelector(t)){const n=(new DOMParser).parseFromString(e,"text/html");i=document.querySelector(t),o=n.querySelector(t).innerHTML}else i=document.querySelector(n.targetElement),o=e;i.innerHTML=o,function(t){for(const e of t.getElementsByTagName("script")){const t=document.createElement("script");e.src?t.src=e.src:t.innerHTML=e.innerHTML,document.head.appendChild(t)}}(i)}function H(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function I(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}var O=new WeakSet;class R{constructor(){H(this,O)}addLoadingIndicator(t){if(!t.querySelector(".loading-indicator")){const e=document.querySelector("body"),n=JSON.parse(e.dataset.svgIcons);t.insertAdjacentHTML("afterbegin",n.loadingIndicatorIcon)}}showLoadingIndicator(t){I(this,O,B).call(this,t,!0)}hideLoadingIndicator(t){I(this,O,B).call(this,t,!1)}}function B(t,e){t.querySelector(".loading-indicator")?.classList.toggle("loading-indicator__active",e)}function D(t,e){_(t,e),e.add(t)}function N(t,e,n){_(t,e),e.set(t,n)}function _(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function z(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function U(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,G(t,e,"get"))}function X(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,G(t,e,"set"),n),n}function G(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var J=new WeakMap,P=new WeakMap,$=new WeakSet,K=new WeakSet,Q=new WeakSet,Y=new WeakSet,Z=new WeakSet,tt=new WeakSet,et=new WeakSet;class nt{constructor(e={}){D(this,et),D(this,tt),D(this,Z),D(this,Y),D(this,Q),D(this,K),D(this,$),N(this,J,{writable:!0,value:{scrollOffsetElement:null}}),N(this,P,{writable:!0,value:void 0}),X(this,P,t(U(this,J),e,{}))}preValidateForm(t){return this.checkFormElementsForErrors(t),z(this,Y,rt).call(this,t),z(this,tt,ct).call(this,t),this.isValid(t)}checkFormElementsForErrors(t){z(this,$,it).call(this,t);for(const e of t.elements)"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName&&"SELECT"!==e.nodeName||e.checkValidity()||(z(this,Q,at).call(this,e,e.validationMessage),t.formValidator||(t.formValidator={}),t.formValidator.isValid=!1)}isValid(t){return!!t.formValidator?.isValid}setFormAsValid(t){t.formValidator={isValid:!0}}handleFormErrorMessages(t,e){if(!(t instanceof HTMLFormElement))return;const n=t.querySelector(".modal-body");document.getElementById("error-box")?.remove(),t.closest(".modal")&&n?n.insertAdjacentHTML("afterbegin",e):t.insertAdjacentHTML("afterbegin",e),z(this,Z,st).call(this,t,document.getElementById("error-box"))}}function it(t){t.querySelectorAll(".is-invalid").forEach((t=>{t.classList.remove("is-invalid")}))}function ot(t){t.closest("div")?.querySelector(".invalid-feedback")?.remove()}function at(t,e){z(this,K,ot).call(this,t),t.classList.add("is-invalid"),t.closest("div:not(.input-group):not(.btn-group)").insertAdjacentHTML("beforeend",`<div class="invalid-feedback">${e}</div>`)}function rt(t){if(!t.querySelector(".nav-tabs"))return;const e=t.querySelector(".is-invalid");if(!e)return;const n=e.closest(".tab-pane").getAttribute("id");t.querySelector('.nav-tabs a[href="#'+n+'"]').click(),e.focus()}function st(t,e){z(this,$,it).call(this,t),e.querySelectorAll("li").forEach((e=>{let n=e.dataset.element;if(n?.length>0){let i=document.getElementById(n)||t.querySelector('[id|="'+n+'"]');i&&(z(this,Q,at).call(this,i[0],e.innerHTML),e.remove())}})),0===e.querySelectorAll("li").length&&e.remove(),z(this,Y,rt).call(this,t),z(this,tt,ct).call(this,t)}function ct(t){if(t.closest(".modal")?.length>0)return;const e=t.querySelectorAll(".is-invalid");if(!e||0===e.length)return;if(z(this,et,lt).call(this,t.querySelector(".invalid-feedback")))return;let n=e.item(0).getBoundingClientRect().top;if(U(this,P).scrollOffsetElement){const t=document.querySelector(U(this,P).scrollOffsetElement);t&&(n-=t.clientHeight)}window.scrollTo({top:n,behavior:"smooth"})}function lt(t){const e=document.querySelector(U(this,P).scrollOffsetElement);let n=0;e&&(n=e.clientHeight);const i=t.getBoundingClientRect();return i.top>=n&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}new k(new R,new nt)})();
//# sourceMappingURL=ajax-form.min.js.map