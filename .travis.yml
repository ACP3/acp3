language: php
sudo: required
dist: trusty
group: edge
php:
  - 5.6
  - 7.0
  - 7.1
  - nightly
  - hhvm

matrix:
  fast_finish: true
  allowed_failues:
    - php: 7.1
    - php: nightly
    - php: hhvm

addons:
  code_climate:
    repo_token: $CC_REPO_TOKEN

before_install:
  - echo -e "machine github.com\n\tlogin $ACP3_CI_USER_GH_TOKEN" >> ~/.netrc

before_script:
  - ./build/travis/before_script.sh $ACP3_CI_USER_GH_TOKEN

script:
  - ./build/travis/run_unit_tests.sh $TRAVIS_PHP_VERSION

after_success:
  - ./build/travis/push_code_coverage.sh $TRAVIS_PHP_VERSION

deploy:
  provider: script
  script: ./build/travis/update_module_repositories.sh ${TRAVIS_TAG}
  on:
    tags: true
    condition: "$TRAVIS_PHP_VERSION = '7.0'"

cache:
  directories:
    - vendor
    - $HOME/.composer/cache
