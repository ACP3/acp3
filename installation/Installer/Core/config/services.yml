parameters:
  default_request: 'install'
  core.environment: !php/const ACP3\Core\Environment\ApplicationMode::INSTALLER

imports:
  - { resource: components/*.yml }
  - { resource: ../View/Renderer/Smarty/config/services.yml }
  - { resource: ../../Modules/Errors/Resources/config/services.yml }
  - { resource: ../../Modules/Install/Resources/config/services.yml }

services:
  core.logger.logger_factory:
    class: ACP3\Core\Logger\LoggerFactory
    arguments:
      - '@core.environment.application_path'

  core.logger.system_logger:
    class: Psr\Log\LoggerInterface
    factory: 'core.logger.logger_factory:create'
    arguments:
      - 'error'

  core.environment.theme:
    class: ACP3\Installer\Core\Environment\Theme
    arguments:
      - '@core.environment.application_path'

  core.installer.migration_registrar:
    class: ACP3\Core\Installer\MigrationRegistrar
    public: true

  core.installer.sample_data_registrar:
    class: ACP3\Core\Installer\SampleDataRegistrar
    public: true

  core.installer.schema_registrar:
    class: ACP3\Core\Installer\SchemaRegistrar
    public: true

  core.installer.model.schema_update_model:
    class: ACP3\Core\Installer\Model\SchemaUpdateModel
    arguments:
      - '@core.environment.application_path'
      - '@core.installer.schema_registrar'
      - '@core.installer.migration_registrar'
      - '@core.modules.vendors'
      - '@core.modules'
      - '@core.modules.schemaUpdater'
      - '@core.xml'

  core.router:
    class: ACP3\Installer\Core\Router\Router
    arguments:
      - '@core.http.request'
      - '@core.environment.application_path'

  core.session:
    class: ACP3\Installer\Core\Session\SessionHandler

  core.view:
    class: ACP3\Core\View
    arguments:
      - '@core.view.renderer.smarty'

  core.view.renderer.smarty.smarty_configurator:
    class: ACP3\Installer\Core\View\Renderer\Smarty\SmartyConfigurator
    arguments:
      - '%core.environment%'

  smarty:
    class: Smarty
    configurator: 'core.view.renderer.smarty.smarty_configurator:configure'

  smarty.plugin.javascripts:
    class: ACP3\Core\View\Renderer\Smarty\Blocks\Javascripts
    tags:
      - { name: smarty.plugin.block, pluginName: javascripts }

  smarty.plugin.stylesheets:
    class: ACP3\Core\View\Renderer\Smarty\Blocks\Stylesheets
    tags:
      - { name: smarty.plugin.block, pluginName: stylesheets }

  core.view.renderer.smarty:
    class: ACP3\Core\View\Renderer\Smarty
    arguments:
      - '@smarty'
      - '@core.view.renderer.smarty.plugin_service_locator'

  core.view.renderer.smarty.plugin_service_locator:
    class: Symfony\Component\DependencyInjection\ServiceLocator
    arguments:
    - []
    tags: ['container.service_locator']

  core.event_dispatcher:
    class: Symfony\Component\EventDispatcher\EventDispatcher
    public: true

  core.xml:
    class: ACP3\Core\XML

  core.modules.vendors:
    class: ACP3\Core\Modules\Vendor
    arguments:
      - '@core.environment.application_path'
