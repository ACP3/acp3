parameters:
  default_request: 'install'

imports:
  - { resource: validation.yml }
  - { resource: ../View/Renderer/Smarty/config/services.yml }
  - { resource: ../../Modules/Errors/Resources/config/services.yml }
  - { resource: ../../Modules/Install/Resources/config/services.yml }

services:
  core.context.install:
    class: ACP3\Installer\Core\Modules\Controller\InstallerContext
    arguments:
      - @core.lang
      - @core.request
      - @core.router
      - @core.view
      - @core.response
      - @core.environment.application_path
    public: false

  core.date:
    class: ACP3\Installer\Core\Date
    arguments: ['@core.lang']

  core.helpers.alerts:
    class: ACP3\Installer\Core\Helpers\Alerts
    arguments: ['@core.request', '@core.view', '@core.helpers.output']

  core.helpers.date:
    class: ACP3\Core\Helpers\Date
    arguments:
      - @core.date
      - @core.lang
      - @core.request
      - @core.helpers.forms
      - @core.validation.validation_rules.date_validation_rule

  core.helpers.forms:
    class: ACP3\Core\Helpers\Forms
    arguments: [@core.lang, @core.request]

  core.helpers.output:
    class: ACP3\Core\Helpers\Output

  core.helpers.redirect:
    class: ACP3\Core\Helpers\RedirectMessages
    arguments: ['@core.redirect', '@core.request', @core.session, '@core.view']

  core.helpers.secure:
    class: ACP3\Core\Helpers\Secure

  core.lang:
    class: ACP3\Installer\Core\I18n\Translator
    arguments:
      - @core.environment.application_path
      - @core.lang.dictionary_cache
      - 'en_US'

  core.lang.dictionary_cache:
    class: ACP3\Installer\Core\I18n\DictionaryCache
    arguments:
      - @core.environment.application_path

  core.logger:
    class: ACP3\Core\Logger
    arguments:
      - @core.environment.application_path

  core.modules.controller.install:
    abstract: true
    arguments: ['@core.context.install']

  core.redirect:
    class: ACP3\Core\Redirect
    arguments: ['@core.request', '@core.router']

  core.request:
    class: ACP3\Installer\Core\Http\Request
    arguments:
      - @core.environment.application_path
      - %default_request%

  core.response:
    class: Symfony\Component\HttpFoundation\Response

  core.router:
    class: ACP3\Installer\Core\Router
    arguments: ['@core.request', @core.environment.application_path]

  core.session:
    class: ACP3\Installer\Core\SessionHandler

  core.view:
    class: ACP3\Core\View
    arguments: [@core.view.renderer.smarty, [compile_id: installer]]

  core.view.renderer.smarty:
    class: ACP3\Installer\Core\View\Renderer\Smarty
    arguments:
      - @core.environment.application_path
    calls:
      - ['setContainer', ['@service_container']]
